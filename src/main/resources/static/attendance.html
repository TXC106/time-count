<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“å¡è€ƒå‹¤ - å·¥æ—¶è®¡ç®—ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-emerald-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <h1 class="text-5xl font-bold text-green-900 mb-4">
                âœ“ æ‰“å¡è€ƒå‹¤
            </h1>
            <p class="text-gray-600 text-lg mb-6">
                è®°å½•æ¯å¤©çš„ä¸Šä¸‹ç­æ—¶é—´ï¼Œæ”¯æŒè¯·å‡è®¾ç½®
            </p>
            <div class="flex justify-center gap-4">
                <a href="/" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                    ğŸ“Š ç»Ÿè®¡é¢æ¿
                </a>
                <a href="/attendance.html" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                    âœ“ æ‰“å¡è€ƒå‹¤
                </a>
                <a href="/config.html" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-semibold">
                    âš™ï¸ é…ç½®ç®¡ç†
                </a>
                <a href="/calendar.html" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold">
                    ğŸ“… æ—¥å†è§†å›¾
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <div class="bg-white rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-300 fade-in max-w-2xl mx-auto">
            <div class="flex items-center mb-6">
                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-white text-3xl mr-4">
                    âœ“
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">æ‰“å¡è€ƒå‹¤</h2>
                    <p class="text-gray-600 mt-1">è®°å½•æ‚¨çš„å·¥ä½œæ—¶é—´å’Œè¯·å‡ä¿¡æ¯</p>
                </div>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        é€‰æ‹©æ—¥æœŸ <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="date" 
                        id="attendanceDate" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                    >
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ä¸Šç­æ—¶é—´
                        </label>
                        <input 
                            type="time" 
                            id="attendanceStartTime" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ä¸‹ç­æ—¶é—´
                        </label>
                        <input 
                            type="time" 
                            id="attendanceEndTime" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                        >
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        è¯·å‡ç±»å‹
                    </label>
                    <select 
                        id="leaveType" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                    >
                        <option value="NONE">æ­£å¸¸å‡ºå‹¤</option>
                        <option value="MORNING">ä¸Šåˆè¯·å‡</option>
                        <option value="AFTERNOON">ä¸‹åˆè¯·å‡</option>
                        <option value="FULL_DAY">å…¨å¤©è¯·å‡</option>
                        <option value="LATE">è¿Ÿåˆ°ï¼ˆ9-10ç‚¹ï¼‰</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        å¤‡æ³¨
                    </label>
                    <textarea 
                        id="attendanceRemark" 
                        placeholder="å¯é€‰ï¼šå¡«å†™è¯·å‡åŸå› æˆ–å…¶ä»–è¯´æ˜"
                        rows="3"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg resize-none"
                    ></textarea>
                </div>
                
                <button 
                    onclick="submitAttendance()" 
                    class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95 text-lg shadow-lg"
                >
                    <span id="attendanceBtn">âœ“ æäº¤æ‰“å¡</span>
                </button>
            </div>
            
            <div id="attendanceResult" class="mt-6"></div>
            
            <div class="mt-6 space-y-3">
                <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-blue-800">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>ä¸‹åˆè¯·å‡ä¸ä¼šæ‰£é™¤åˆä¼‘æ—¶é—´
                    </p>
                </div>
                <div class="p-4 bg-green-50 border-l-4 border-green-400 rounded">
                    <p class="text-green-800">
                        <strong>âœ“ æ­£å¸¸å‡ºå‹¤ï¼š</strong>å¡«å†™ä¸Šç­å’Œä¸‹ç­æ—¶é—´å³å¯
                    </p>
                </div>
                <div class="p-4 bg-orange-50 border-l-4 border-orange-400 rounded">
                    <p class="text-orange-800">
                        <strong>ğŸ–ï¸ è¯·å‡è¯´æ˜ï¼š</strong>
                    </p>
                    <ul class="mt-2 space-y-1 text-sm text-orange-700 ml-4">
                        <li>â€¢ <strong>å…¨å¤©è¯·å‡ï¼š</strong>ä¸å¡«ä¸Šä¸‹ç­æ—¶é—´</li>
                        <li>â€¢ <strong>ä¸Šåˆè¯·å‡ï¼š</strong>åªå¡«ä¸‹ç­æ—¶é—´</li>
                        <li>â€¢ <strong>ä¸‹åˆè¯·å‡ï¼š</strong>åªå¡«ä¸Šç­æ—¶é—´</li>
                        <li>â€¢ <strong>è¿Ÿåˆ°ï¼š</strong>9ç‚¹å10ç‚¹å‰ä¸Šç­ï¼Œé€‰æ‹©"è¿Ÿåˆ°"ä¸æ‰£è¯·å‡æ—¶é•¿</li>
                        <li>â€¢ <strong>è‡ªåŠ¨åˆ¤æ–­ï¼š</strong>ç³»ç»Ÿä¼šæ ¹æ®æ‰“å¡æ—¶é—´è‡ªåŠ¨è®¡ç®—è¯·å‡æ—¶é•¿</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-600">
            <p>å·¥æ—¶è®¡ç®—ç³»ç»Ÿ v1.0 | Spring Boot + Apache POI</p>
        </footer>
    </div>

    <script>
        // è®¾ç½®å½“å‰æ—¥æœŸä¸ºé»˜è®¤å€¼
        const currentDate = new Date().toISOString().slice(0, 10);
        document.getElementById('attendanceDate').value = currentDate;
        
        // ä»URLå‚æ•°ä¸­è·å–é¢„å¡«æ•°æ®
        const urlParams = new URLSearchParams(window.location.search);
        const dateParam = urlParams.get('date');
        const startTimeParam = urlParams.get('startTime');
        const endTimeParam = urlParams.get('endTime');
        
        if (dateParam) {
            document.getElementById('attendanceDate').value = dateParam;
        }
        if (startTimeParam && startTimeParam !== 'null') {
            document.getElementById('attendanceStartTime').value = startTimeParam;
        }
        if (endTimeParam && endTimeParam !== 'null') {
            document.getElementById('attendanceEndTime').value = endTimeParam;
        }

        // æäº¤è€ƒå‹¤æ‰“å¡
        async function submitAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const startTime = document.getElementById('attendanceStartTime').value;
            const endTime = document.getElementById('attendanceEndTime').value;
            const leaveType = document.getElementById('leaveType').value;
            const remark = document.getElementById('attendanceRemark').value;
            const resultDiv = document.getElementById('attendanceResult');
            const btn = document.getElementById('attendanceBtn');
            
            if (!date) {
                showMessage(resultDiv, 'è¯·é€‰æ‹©æ—¥æœŸ', 'error');
                return;
            }

            // å¦‚æœä¸æ˜¯å…¨å¤©è¯·å‡ï¼Œè‡³å°‘éœ€è¦å¡«å†™ä¸€ä¸ªæ—¶é—´
            if (leaveType !== 'FULL_DAY' && !startTime && !endTime) {
                showMessage(resultDiv, 'è¯·è‡³å°‘å¡«å†™ä¸Šç­æˆ–ä¸‹ç­æ—¶é—´', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span>';
            
            try {
                const requestBody = {
                    date: date,
                    startTime: startTime || null,
                    endTime: endTime || null,
                    leaveType: leaveType,
                    remark: remark || null
                };

                const response = await fetch('/api/workhours/attendance/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(resultDiv, 'âœ… æ‰“å¡æˆåŠŸï¼æ•°æ®å·²åŒæ­¥åˆ°Excelæ–‡ä»¶', 'success');
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('attendanceStartTime').value = '';
                    document.getElementById('attendanceEndTime').value = '';
                    document.getElementById('leaveType').value = 'NONE';
                    document.getElementById('attendanceRemark').value = '';
                } else {
                    showMessage(resultDiv, `âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(resultDiv, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.innerHTML = 'âœ“ æäº¤æ‰“å¡';
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(element, message, type) {
            const bgColor = type === 'success' ? 'bg-green-50 border-green-500 text-green-800' : 'bg-red-50 border-red-500 text-red-800';
            element.innerHTML = `
                <div class="${bgColor} border-l-4 p-4 rounded text-sm animate-pulse">
                    ${message}
                </div>
            `;
            setTimeout(() => {
                if (type === 'success') {
                    element.innerHTML = '';
                }
            }, 5000);
        }
    </script>
</body>
</html>
