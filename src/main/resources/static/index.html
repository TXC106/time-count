<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥æ—¶è®¡ç®—ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .slide-in {
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .scale-in {
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-primary {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl shadow-lg mb-6 scale-in">
                <i data-lucide="bar-chart-3" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="text-6xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 bg-clip-text text-transparent mb-4">
                å·¥æ—¶è®¡ç®—ç³»ç»Ÿ
            </h1>
            <p class="text-gray-600 text-lg mb-8 font-medium">
                æ™ºèƒ½è€ƒå‹¤ç®¡ç† Â· è‡ªåŠ¨å·¥æ—¶ç»Ÿè®¡ Â· æ•°æ®å¯è§†åŒ–åˆ†æ
            </p>
            <div class="flex flex-wrap justify-center gap-3">
                <a href="/" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white rounded-xl hover:from-indigo-700 hover:to-indigo-800 transition-all font-semibold shadow-lg hover:shadow-xl btn-primary">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    ç»Ÿè®¡é¢æ¿
                </a>
                <a href="/attendance.html" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-xl hover:from-emerald-700 hover:to-emerald-800 transition-all font-semibold shadow-lg hover:shadow-xl btn-primary">
                    <i data-lucide="check-circle" class="w-5 h-5"></i>
                    æ‰“å¡è€ƒå‹¤
                </a>
                <a href="/config.html" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-600 to-amber-700 text-white rounded-xl hover:from-amber-700 hover:to-amber-800 transition-all font-semibold shadow-lg hover:shadow-xl btn-primary">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    é…ç½®ç®¡ç†
                </a>
                <a href="/calendar.html" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl hover:from-purple-700 hover:to-purple-800 transition-all font-semibold shadow-lg hover:shadow-xl btn-primary">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    æ—¥å†è§†å›¾
                </a>
            </div>
        </header>

        <!-- åŠŸèƒ½åŒº -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <!-- åŠŸèƒ½3: ç”Ÿæˆæ¨¡æ¿ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover slide-in border border-indigo-100">
                <div class="flex items-center mb-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-md mr-4">
                        <i data-lucide="file-text" class="w-7 h-7"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">ç”Ÿæˆæ¨¡æ¿</h2>
                </div>
                <p class="text-gray-600 mb-6">
                    è‡ªåŠ¨ç”ŸæˆæŒ‡å®šæœˆä»½çš„è€ƒå‹¤è¡¨æ ¼æ¨¡æ¿ï¼ŒåŒ…å«æ—¥æœŸã€æ˜ŸæœŸç­‰ä¿¡æ¯ã€‚
                </p>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            é€‰æ‹©æœˆä»½
                        </label>
                        <input
                            type="month"
                            id="templateMonth"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>

                    <button
                        onclick="generateTemplate()"
                        class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition-all shadow-md hover:shadow-lg btn-primary flex items-center justify-center gap-2"
                    >
                        <i data-lucide="plus-circle" class="w-5 h-5"></i>
                        <span id="generateBtn">ç”Ÿæˆæ¨¡æ¿</span>
                    </button>
                </div>

                <div id="generateResult" class="mt-4"></div>
            </div>

            <!-- åŠŸèƒ½4: å¡«å†™è¯´æ˜ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover slide-in border border-indigo-100" style="animation-delay: 0.1s">
                <div class="flex items-center mb-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center text-white shadow-md mr-4">
                        <i data-lucide="edit-3" class="w-7 h-7"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">å¡«å†™è¯´æ˜</h2>
                </div>
                <p class="text-gray-600 mb-6">
                    æ‰“å¡æ–¹å¼è¯´æ˜ã€‚
                </p>

                <div class="bg-blue-50 rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800 mb-2">ğŸ“‹ æ‰“å¡æ–¹å¼ï¼š</h3>
                    <ol class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">1</span>
                            <span>ä½¿ç”¨â€œæ‰“å¡è€ƒå‹¤â€é¡µé¢åœ¨çº¿æäº¤</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">2</span>
                            <span>ä½¿ç”¨ä¸‹æ–¹â€œåœ¨çº¿å¡«å†™â€åŠŸèƒ½æ‰¹é‡ç¼–è¾‘</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">3</span>
                            <span>æˆ–æ‰‹åŠ¨åœ¨Excelæ–‡ä»¶ä¸­å¡«å†™æ—¶é—´</span>
                        </li>
                    </ol>
                </div>

                <div class="mt-4">
                    <button
                        onclick="openExcelEditor()"
                        class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-all shadow-md hover:shadow-lg btn-primary flex items-center justify-center gap-2"
                    >
                        <i data-lucide="table" class="w-5 h-5"></i>
                        åœ¨çº¿å¡«å†™Excel
                    </button>
                </div>

                <div class="bg-green-50 rounded-lg p-4 space-y-3 mt-4">
                    <h3 class="font-semibold text-gray-800 mb-2">ğŸ“ Excelæ‰‹åŠ¨å¡«å†™ï¼š</h3>
                    <ol class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-start">
                            <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">1</span>
                            <span>æ‰“å¼€ <code class="bg-gray-200 px-1 rounded">data</code> ç›®å½•ä¸‹çš„Excelæ–‡ä»¶</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">2</span>
                            <span>å¡«å†™"ä¸Šç­æ—¶é—´"å’Œ"ä¸‹ç­æ—¶é—´"åˆ—</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">3</span>
                            <span>æ ¼å¼ï¼š<code class="bg-gray-200 px-1 rounded font-mono">8:56</code></span>
                        </li>
                    </ol>
                </div>

                <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                    <p class="text-sm text-yellow-800">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>æ¨èä½¿ç”¨åœ¨çº¿æ‰“å¡ï¼Œæ•°æ®è‡ªåŠ¨åŒæ­¥
                    </p>
                </div>
            </div>

            <!-- åŠŸèƒ½5: è®¡ç®—å·¥æ—¶ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 card-hover slide-in border border-indigo-100" style="animation-delay: 0.2s">
                <div class="flex items-center mb-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-md mr-4">
                        <i data-lucide="calculator" class="w-7 h-7"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">è®¡ç®—å·¥æ—¶</h2>
                </div>
                <p class="text-gray-600 mb-6">
                    è‡ªåŠ¨è®¡ç®—å·¥æ—¶ç»Ÿè®¡ï¼ŒåŒ…æ‹¬æ€»å·¥æ—¶ã€å¹³å‡å·¥æ—¶ã€è¯·å‡ç»Ÿè®¡ç­‰ã€‚
                </p>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            é€‰æ‹©æœˆä»½
                        </label>
                        <input
                            type="month"
                            id="calculateMonth"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        >
                    </div>

                    <button
                        onclick="calculateWorkHours()"
                        class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition-all shadow-md hover:shadow-lg btn-primary flex items-center justify-center gap-2"
                    >
                        <i data-lucide="play-circle" class="w-5 h-5"></i>
                        <span id="calculateBtn">è®¡ç®—å·¥æ—¶</span>
                    </button>
                </div>

                <div id="calculateResult" class="mt-4"></div>
            </div>
        </div>

        <!-- Excelåœ¨çº¿ç¼–è¾‘å¼¹çª— -->
        <div id="excelEditorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden scale-in">
                <div class="bg-gradient-to-r from-cyan-500 via-blue-500 to-indigo-600 text-white p-6 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i data-lucide="table" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold">åœ¨çº¿Excelç¼–è¾‘å™¨</h2>
                            <p class="text-cyan-100 mt-1" id="excelEditorTitle">é€‰æ‹©æœˆä»½å¹¶ç¼–è¾‘è€ƒå‹¤æ•°æ®</p>
                        </div>
                    </div>
                    <button
                        onclick="closeExcelEditor()"
                        class="text-white hover:text-gray-200 text-3xl font-bold w-12 h-12 flex items-center justify-center rounded-xl hover:bg-white hover:bg-opacity-20 transition-all"
                    >
                        <i data-lucide="x" class="w-8 h-8"></i>
                    </button>
                </div>

                <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 200px);">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            é€‰æ‹©æœˆä»½
                        </label>
                        <div class="flex gap-3">
                            <input
                                type="month"
                                id="excelEditorMonth"
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                            >
                            <button
                                onclick="loadExcelData()"
                                class="bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-semibold py-2 px-6 rounded-xl transition-all shadow-md hover:shadow-lg btn-primary flex items-center gap-2"
                            >
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                <span id="loadExcelBtn">åŠ è½½æ•°æ®</span>
                            </button>
                        </div>
                    </div>

                    <div id="excelDataContainer" class="hidden">
                        <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-lg shadow-sm">
                            <div class="flex items-start gap-2">
                                <i data-lucide="info" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                                <p class="text-blue-800 text-sm">
                                    <strong>æç¤ºï¼š</strong>ç›´æ¥åœ¨è¡¨æ ¼ä¸­ä¿®æ”¹æ—¶é—´ï¼Œä¿®æ”¹åè‡ªåŠ¨ä¿å­˜åˆ°Excelæ–‡ä»¶
                                </p>
                            </div>
                        </div>

                        <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm">
                            <table class="min-w-full bg-white">
                                <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">æ—¥æœŸ</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">æ˜ŸæœŸ</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">ä¸Šç­æ—¶é—´</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">ä¸‹ç­æ—¶é—´<span class="text-xs text-gray-500 ml-1">(å‹¾é€‰+1è¡¨ç¤ºæ¬¡æ—¥)</span></th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">è¯·å‡ç±»å‹</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">è‡ªå®šä¹‰å¼€å§‹</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">è‡ªå®šä¹‰ç»“æŸ</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-semibold text-gray-700">å·¥æ—¶</th>
                                        <th class="px-4 py-3 border-b text-center text-sm font-semibold text-gray-700">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="excelTableBody">
                                    <!-- æ•°æ®å°†åŠ¨æ€æ’å…¥ -->
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-6 flex justify-end">
                            <button
                                onclick="closeExcelEditor()"
                                class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-2 px-6 rounded-xl transition-all shadow-md hover:shadow-lg btn-primary flex items-center gap-2"
                            >
                                <i data-lucide="x" class="w-4 h-4"></i>
                                å…³é—­
                            </button>
                        </div>
                    </div>

                    <div id="excelLoadingMessage" class="text-center py-12 text-gray-500">
                        è¯·é€‰æ‹©æœˆä»½å¹¶ç‚¹å‡»â€œåŠ è½½æ•°æ®â€
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡æŠ¥å‘ŠåŒºåŸŸ -->
        <div id="reportSection" class="hidden">
            <div class="bg-white rounded-3xl shadow-2xl p-8 fade-in border border-indigo-100">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                        </div>
                        <h2 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">å·¥æ—¶ç»Ÿè®¡æŠ¥å‘Š</h2>
                    </div>
                    <button
                        onclick="closeReport()"
                        class="text-gray-400 hover:text-gray-600 w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 transition-all"
                    >
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>

                <div id="reportContent" class="space-y-6">
                    <!-- æŠ¥å‘Šå†…å®¹å°†åŠ¨æ€æ’å…¥ -->
                </div>
            </div>
        </div>

        <!-- è®¡ç®—è§„åˆ™è¯´æ˜ -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mt-8 fade-in border border-indigo-100">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                    <i data-lucide="info" class="w-6 h-6 text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">å·¥æ—¶è®¡ç®—è§„åˆ™</h2>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">ğŸ“Œ åŸºæœ¬è§„åˆ™</h3>
                    <ul class="space-y-2 text-gray-700 text-sm">
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>å·¥æ—¶ = ä¸‹ç­ - ä¸Šç­ - åˆä¼‘ - æ™šé¤</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>æ­£å¸¸æƒ…å†µæ‰£é™¤åˆä¼‘æ—¶é—´ï¼ˆé»˜è®¤1å°æ—¶ï¼‰</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>ä¸‹ç­æ™šäºä¸´ç•Œç‚¹æ‰£é™¤æ™šé¤æ—¶é—´ï¼ˆé»˜è®¤19ç‚¹åæ‰£0.5å°æ—¶ï¼‰</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>æ‰€æœ‰æ—¶é—´å‚æ•°å¯åœ¨é…ç½®ç®¡ç†ä¸­è‡ªå®šä¹‰</span>
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">ğŸ–ï¸ è¯·å‡è§„åˆ™</h3>
                    <ul class="space-y-2 text-gray-700 text-sm">
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span><strong>å…¨å¤©è¯·å‡ï¼š</strong>ä¸å¡«ä¸Šä¸‹ç­æ—¶é—´</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span><strong>ä¸Šåˆè¯·å‡ï¼š</strong>åªå¡«ä¸‹ç­æ—¶é—´</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span><strong>ä¸‹åˆè¯·å‡ï¼š</strong>åªå¡«ä¸Šç­æ—¶é—´ï¼Œ<em>ä¸æ‰£åˆä¼‘</em></span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span>ä¸Šç­æ™šäºæ ‡å‡†æ—¶é—´ï¼ˆé»˜è®¤9ç‚¹ï¼‰æˆ–ä¸‹ç­æ—©äºæ ‡å‡†æ—¶é—´ï¼ˆé»˜è®¤18ç‚¹ï¼‰è§†ä¸ºè¯·å‡</span>
                        </li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">âš™ï¸ è‡ªå®šä¹‰é…ç½®</h3>
                    <ul class="space-y-2 text-gray-700 text-sm">
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">â€¢</span>
                            <span><strong>æœŸæœ›æ€»å·¥æ—¶ï¼š</strong>ç”¨äºè®¡ç®—ç›®æ ‡å·®è·</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">â€¢</span>
                            <span><strong>åˆä¼‘æ—¶é—´ï¼š</strong>æ¯å¤©æ‰£é™¤çš„åˆä¼‘æ—¶é•¿</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">â€¢</span>
                            <span><strong>æ™šé¤æ—¶é—´ï¼š</strong>åŠ ç­æ—¶æ‰£é™¤çš„æ™šé¤æ—¶é•¿</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 mr-2">â€¢</span>
                            <span><strong>æ ‡å‡†å·¥æ—¶ï¼š</strong>ç”¨äºåˆ¤å®šè¿Ÿåˆ°æ—©é€€</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-500 pb-8">
            <div class="flex items-center justify-center gap-2 mb-2">
                <i data-lucide="code" class="w-4 h-4"></i>
                <p class="font-medium">å·¥æ—¶è®¡ç®—ç³»ç»Ÿ v1.0</p>
            </div>
            <p class="text-sm">Spring Boot + Apache POI + TailwindCSS</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ– Lucide å›¾æ ‡
        lucide.createIcons();
    </script>

    <script>
        // è®¾ç½®å½“å‰æœˆä»½ä¸ºé»˜è®¤å€¼
        const currentMonth = new Date().toISOString().slice(0, 7);
        document.getElementById('templateMonth').value = currentMonth;
        
        // å…¨å±€å˜é‡ï¼šå½“å‰åŠ è½½çš„Excelæœˆä»½
        let currentYearMonth = null;
        document.getElementById('calculateMonth').value = currentMonth;

        // ç”Ÿæˆæ¨¡æ¿
        async function generateTemplate() {
            const month = document.getElementById('templateMonth').value;
            const resultDiv = document.getElementById('generateResult');
            const btn = document.getElementById('generateBtn');

            if (!month) {
                showMessage(resultDiv, 'è¯·é€‰æ‹©æœˆä»½', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span>';

            try {
                const response = await fetch(`/api/workhours/template/generate?yearMonth=${month}`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    showMessage(resultDiv, `âœ… æ¨¡æ¿ç”ŸæˆæˆåŠŸï¼<br><small class="text-xs">æ–‡ä»¶è·¯å¾„: ${data.filePath}</small>`, 'success');
                } else {
                    showMessage(resultDiv, `âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(resultDiv, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.textContent = 'ç”Ÿæˆæ¨¡æ¿';
            }
        }

        // è®¡ç®—å·¥æ—¶
        async function calculateWorkHours() {
            const month = document.getElementById('calculateMonth').value;
            const resultDiv = document.getElementById('calculateResult');
            const btn = document.getElementById('calculateBtn');

            if (!month) {
                showMessage(resultDiv, 'è¯·é€‰æ‹©æœˆä»½', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span>';

            try {
                const response = await fetch(`/api/workhours/calculate?yearMonth=${month}`);
                const data = await response.json();

                if (data.success) {
                    showMessage(resultDiv, 'âœ… è®¡ç®—å®Œæˆï¼', 'success');
                    displayReport(data.statistics);
                } else {
                    showMessage(resultDiv, `âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(resultDiv, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.textContent = 'è®¡ç®—å·¥æ—¶';
            }
        }

        // æ˜¾ç¤ºæŠ¥å‘Š
        function displayReport(stats) {
            const reportSection = document.getElementById('reportSection');
            const reportContent = document.getElementById('reportContent');

            const html = `
                <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl p-6 mb-6">
                    <h3 class="text-2xl font-bold mb-2">${stats.yearMonth}</h3>
                    <p class="text-blue-100">å·¥æ—¶ç»Ÿè®¡æœˆåº¦æŠ¥å‘Š</p>
                </div>

                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600 mb-1">å½“æœˆæ€»å·¥æ—¶</div>
                        <div class="text-3xl font-bold text-blue-600">${stats.totalWorkHours}</div>
                        <div class="text-sm text-gray-500">å°æ—¶</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 relative group">
                        <div class="text-sm text-gray-600 mb-1 flex items-center gap-1">
                            å‡ºå‹¤å¤©æ•°
                            <span class="text-xs text-green-500 cursor-help">â„¹ï¸</span>
                        </div>
                        <div class="text-3xl font-bold ${stats.actualAttendanceDays >= 21 ? 'text-green-600' : 'text-green-600'}">${stats.actualAttendanceDays}</div>
                        <div class="text-sm text-gray-500">å¤©</div>
                        <div class="absolute hidden group-hover:block bg-gray-800 text-white text-xs rounded py-2 px-3 bottom-full left-1/2 transform -translate-x-1/2 mb-2 whitespace-nowrap z-10">
                            æ¨è: 21å¤© | æœ‰å·¥æ—¶: ${stats.attendanceDays}å¤©
                            <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"></div>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 relative group">
                        <div class="text-sm text-gray-600 mb-1 flex items-center gap-1">
                            21ç‚¹åæ‰“å¡
                            <span class="text-xs text-orange-500 cursor-help">â„¹ï¸</span>
                        </div>
                        <div class="text-3xl font-bold ${stats.lateNightCheckInCount >= 13 ? 'text-green-600' : 'text-orange-600'}">${stats.lateNightCheckInCount}</div>
                        <div class="text-sm text-gray-500">æ¬¡</div>
                        <div class="absolute hidden group-hover:block bg-gray-800 text-white text-xs rounded py-2 px-3 bottom-full left-1/2 transform -translate-x-1/2 mb-2 whitespace-nowrap z-10">
                            æ¨èæ¬¡æ•°: 13æ¬¡
                            <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"></div>
                        </div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600 mb-1">æ—¥å¹³å‡å·¥æ—¶</div>
                        <div class="text-3xl font-bold text-purple-600">${stats.averageWorkHoursPerDay}</div>
                        <div class="text-sm text-gray-500">å°æ—¶/å¤©</div>
                    </div>
                </div>

                <div class="border-t pt-6">
                    <h4 class="font-bold text-lg mb-4">ğŸ¯ æœŸæœ›ç›®æ ‡</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-4">
                            <span class="text-gray-700">æœŸæœ›æ€»å·¥æ—¶</span>
                            <span class="font-bold text-xl">${stats.expectedTotalHours} å°æ—¶</span>
                        </div>
                        <div class="flex justify-between items-center ${stats.remainingHoursToTarget > 0 ? 'bg-orange-50' : 'bg-green-50'} rounded-lg p-4">
                            <span class="text-gray-700">è·ç¦»ç›®æ ‡</span>
                            <span class="font-bold text-xl ${stats.remainingHoursToTarget > 0 ? 'text-orange-600' : 'text-green-600'}">
                                ${stats.remainingHoursToTarget > 0 ? '+' : ''}${stats.remainingHoursToTarget} å°æ—¶
                            </span>
                        </div>
                    </div>
                </div>

                <div class="border-t pt-6 mt-6">
                    <h4 class="font-bold text-lg mb-4">ğŸ“… å‰©ä½™è§„åˆ’</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-4">
                            <span class="text-gray-700">å‰©ä½™å·¥ä½œæ—¥</span>
                            <span class="font-bold text-xl">${stats.remainingWorkdays} å¤©</span>
                        </div>
                        <div class="flex justify-between items-center bg-indigo-50 rounded-lg p-4">
                            <span class="text-gray-700">éœ€è¦æ—¥å‡å·¥æ—¶</span>
                            <span class="font-bold text-xl text-indigo-600">${stats.requiredAverageHoursForRemainingDays} å°æ—¶/å¤©</span>
                        </div>
                    </div>
                </div>

                ${stats.leaveDays > 0 ? `
                <div class="border-t pt-6 mt-6">
                    <h4 class="font-bold text-lg mb-4">ğŸ–ï¸ è¯·å‡ç»Ÿè®¡</h4>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="flex justify-between items-center bg-yellow-50 rounded-lg p-4">
                            <span class="text-gray-700">è¯·å‡å¤©æ•°</span>
                            <span class="font-bold text-xl text-yellow-600">${stats.leaveDays} å¤©</span>
                        </div>
                        <div class="flex justify-between items-center bg-yellow-50 rounded-lg p-4">
                            <span class="text-gray-700">è¯·å‡æ€»æ—¶é•¿</span>
                            <span class="font-bold text-xl text-yellow-600">${stats.totalLeaveHours} å°æ—¶</span>
                        </div>
                    </div>

                    ${stats.leaveRecords && stats.leaveRecords.length > 0 ? `
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <h5 class="font-semibold text-gray-800 mb-3">ğŸ“‹ è¯·å‡æ˜ç»†</h5>
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${stats.leaveRecords.map(record => {
                                const leaveTimeStr = record.leaveStartTime && record.leaveEndTime
                                    ? `<span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-700">
                                        ${record.leaveStartTime} ~ ${record.leaveEndTime}
                                       </span>`
                                    : '';

                                const workTimeStr = record.startTime || record.endTime
                                    ? `æ‰“å¡: ${record.startTime || 'æœªæ‰“å¡'} ~ ${record.endTime || 'æœªæ‰“å¡'}`
                                    : 'å…¨å¤©æœªæ‰“å¡';

                                return `
                                <div class="flex items-center justify-between bg-white rounded p-3 text-sm hover:shadow-md transition-shadow">
                                    <div class="flex items-center space-x-3">
                                        <span class="font-medium text-gray-700">${record.date}</span>
                                        ${leaveTimeStr}
                                        <span class="text-gray-500 text-xs">${workTimeStr}</span>
                                    </div>
                                    <span class="font-semibold text-yellow-600">${record.leaveHours.toFixed(2)} å°æ—¶</span>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
                ` : ''}

                ${stats.lateDays > 0 ? `
                <div class="border-t pt-6 mt-6">
                    <h4 class="font-bold text-lg mb-4">â° è¿Ÿåˆ°ç»Ÿè®¡</h4>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="flex justify-between items-center bg-red-50 rounded-lg p-4">
                            <span class="text-gray-700">è¿Ÿåˆ°å¤©æ•°</span>
                            <span class="font-bold text-xl text-red-600">${stats.lateDays} å¤©</span>
                        </div>
                        <div class="flex justify-between items-center bg-red-50 rounded-lg p-4">
                            <span class="text-gray-700">è¿Ÿåˆ°ç‡</span>
                            <span class="font-bold text-xl text-red-600">
                                ${stats.actualAttendanceDays > 0 ? ((stats.lateDays / stats.actualAttendanceDays) * 100).toFixed(1) : '0.0'}%
                            </span>
                        </div>
                    </div>

                    ${stats.lateRecords && stats.lateRecords.length > 0 ? `
                    <div class="bg-red-50 rounded-lg p-4">
                        <h5 class="font-semibold text-gray-800 mb-3">ğŸ“‹ è¿Ÿåˆ°æ˜ç»†</h5>
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${stats.lateRecords.map(record => {
                                const standardStart = new Date('2000-01-01 09:00:00');
                                const actualStart = new Date('2000-01-01 ' + record.startTime);
                                const lateMinutes = Math.floor((actualStart - standardStart) / 60000);

                                return `
                                <div class="bg-white rounded p-3 text-sm hover:shadow-md transition-shadow">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-3">
                                            <span class="font-medium text-gray-700">${record.date}</span>
                                            <span class="text-gray-500">${record.dayOfWeek}</span>
                                            <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-700">
                                                è¿Ÿåˆ° ${lateMinutes} åˆ†é’Ÿ
                                            </span>
                                        </div>
                                        <span class="font-semibold text-indigo-600">${record.workHours.toFixed(2)}h</span>
                                    </div>
                                    <div class="flex items-center space-x-4 text-xs text-gray-500">
                                        <span>ğŸ• ä¸Šç­: ${record.startTime}</span>
                                        <span>ğŸ•” ä¸‹ç­: ${record.endTime || 'æœªæ‰“å¡'}</span>
                                    </div>
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
                ` : ''}
            `;

            reportContent.innerHTML = html;
            reportSection.classList.remove('hidden');
            reportSection.scrollIntoView({ behavior: 'smooth' });
        }

        // å…³é—­æŠ¥å‘Š
        function closeReport() {
            document.getElementById('reportSection').classList.add('hidden');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(element, message, type) {
            const bgColor = type === 'success' ? 'bg-green-50 border-green-500 text-green-800' : 'bg-red-50 border-red-500 text-red-800';
            element.innerHTML = `
                <div class="${bgColor} border-l-4 p-3 rounded text-sm">
                    ${message}
                </div>
            `;
            setTimeout(() => {
                if (type === 'success') {
                    element.innerHTML = '';
                }
            }, 5000);
        }

        // æ‰“å¼€Excelç¼–è¾‘å™¨
        async function openExcelEditor() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('excelEditorMonth').value = currentMonth;
            document.getElementById('excelEditorModal').classList.remove('hidden');

            // è‡ªåŠ¨åŠ è½½å½“å‰æœˆä»½æ•°æ®
            await loadExcelData();
        }

        // å…³é—­Excelç¼–è¾‘å™¨
        function closeExcelEditor() {
            document.getElementById('excelEditorModal').classList.add('hidden');
            document.getElementById('excelDataContainer').classList.add('hidden');
            document.getElementById('excelLoadingMessage').classList.remove('hidden');
        }

        // åŠ è½½Excelæ•°æ®
        async function loadExcelData() {
            const month = document.getElementById('excelEditorMonth').value;
            const btn = document.getElementById('loadExcelBtn');

            if (!month) {
                alert('è¯·é€‰æ‹©æœˆä»½');
                return;
            }

            btn.innerHTML = '<span class="loading"></span> åŠ è½½ä¸­...';

            try {
                const response = await fetch(`/api/workhours/excel/data?yearMonth=${month}`);
                const data = await response.json();

                if (data.success) {
                    displayExcelData(data.data, month);
                    document.getElementById('excelDataContainer').classList.remove('hidden');
                    document.getElementById('excelLoadingMessage').classList.add('hidden');
                } else {
                    alert(`åŠ è½½å¤±è´¥: ${data.message}`);
                }
            } catch (error) {
                alert(`è¯·æ±‚å¤±è´¥: ${error.message}`);
            } finally {
                btn.innerHTML = 'ğŸ”„ åŠ è½½æ•°æ®';
            }
        }

        // æ˜¾ç¤ºExcelæ•°æ®
        function displayExcelData(records, yearMonth) {
            const tbody = document.getElementById('excelTableBody');
            document.getElementById('excelEditorTitle').textContent = `${yearMonth} è€ƒå‹¤æ•°æ®`;
            
            // ä¿å­˜å½“å‰æœˆä»½
            currentYearMonth = yearMonth;

            const today = new Date().toISOString().slice(0, 10);

            tbody.innerHTML = records.map((record, index) => {
                const isWeekend = !record.workday;
                const isToday = record.date === today;
                const zebraClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                const rowClass = isToday ? 'bg-blue-100' : (isWeekend ? 'bg-gray-100' : zebraClass);
                
                // è§£æä¸‹ç­æ—¶é—´ï¼Œä½¿ç”¨endTimeRawå­—æ®µï¼ˆåŒ…å«+1æ ‡è®°ï¼‰
                const endTimeRaw = record.endTimeRaw || record.endTime || '';
                const isEndNextDay = endTimeRaw.includes('+1');
                const endTimeValue = endTimeRaw.replace('+1', '').trim();

                return `
                    <tr class="${rowClass} hover:bg-indigo-50 transition-all duration-200" data-date="${record.date}" id="row-${record.date}">
                        <td class="px-4 py-3 border-b text-sm font-medium">${record.date}${isToday ? ' <span class="text-xs text-cyan-600 font-bold">ä»Šå¤©</span>' : ''}</td>
                        <td class="px-4 py-3 border-b text-sm">${record.dayOfWeek}</td>
                        <td class="px-4 py-3 border-b text-sm">
                            <input
                                type="time"
                                value="${record.startTime || ''}"
                                onchange="updateAttendance('${record.date}', 'startTime', this.value, event)"
                                class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                            >
                        </td>
                        <td class="px-4 py-3 border-b text-sm">
                            <div class="flex items-center gap-1">
                                <input
                                    type="time"
                                    value="${endTimeValue}"
                                    onchange="updateAttendance('${record.date}', 'endTime', this.value, event)"
                                    class="flex-1 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                                >
                                <label class="flex items-center gap-1 cursor-pointer whitespace-nowrap text-xs">
                                    <input
                                        type="checkbox"
                                        ${isEndNextDay ? 'checked' : ''}
                                        onchange="updateAttendance('${record.date}', 'endTimeNextDay', this.checked, event)"
                                        class="w-4 h-4 text-cyan-600"
                                    >
                                    <span>+1</span>
                                </label>
                            </div>
                        </td>
                        <td class="px-4 py-3 border-b text-sm">
                            <select
                                onchange="updateAttendance('${record.date}', 'leaveType', this.value, event)"
                                class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-sm"
                                data-date="${record.date}"
                            >
                                <option value="\u6b63\u5e38" ${(!record.leaveType || record.leaveType === 'NONE' || record.leaveType === '\u6b63\u5e38') ? 'selected' : ''}>\u6b63\u5e38</option>
                                <option value="\u4e0a\u5348\u8bf7\u5047" ${record.leaveType === 'MORNING' || record.leaveType === '\u4e0a\u5348\u8bf7\u5047' ? 'selected' : ''}>\u4e0a\u5348\u8bf7\u5047</option>
                                <option value="\u4e0b\u5348\u8bf7\u5047" ${record.leaveType === 'AFTERNOON' || record.leaveType === '\u4e0b\u5348\u8bf7\u5047' ? 'selected' : ''}>\u4e0b\u5348\u8bf7\u5047</option>
                                <option value="\u5168\u5929\u8bf7\u5047" ${record.leaveType === 'FULL_DAY' || record.leaveType === '\u5168\u5929\u8bf7\u5047' ? 'selected' : ''}>\u5168\u5929\u8bf7\u5047</option>
                                <option value="\u81ea\u5b9a\u4e49\u65f6\u95f4\u6bb5" ${record.leaveType === 'CUSTOM' || record.leaveType === '\u81ea\u5b9a\u4e49\u65f6\u95f4\u6bb5' ? 'selected' : ''}>\u81ea\u5b9a\u4e49\u65f6\u95f4\u6bb5</option>
                            </select>
                        </td>
                        <td class="px-4 py-3 border-b text-sm">
                            <input
                                type="time"
                                value="${record.leaveStartTime || ''}"
                                onchange="updateAttendance('${record.date}', 'leaveStartTime', this.value, event)"
                                class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                                ${(record.leaveType !== 'CUSTOM' && record.leaveType !== '\u81ea\u5b9a\u4e49\u65f6\u95f4\u6bb5') ? 'disabled style="background-color: #f3f4f6;"' : ''}
                            >
                        </td>
                        <td class="px-4 py-3 border-b text-sm">
                            <input
                                type="time"
                                value="${record.leaveEndTime || ''}"
                                onchange="updateAttendance('${record.date}', 'leaveEndTime', this.value, event)"
                                class="w-full px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                                ${(record.leaveType !== 'CUSTOM' && record.leaveType !== '\u81ea\u5b9a\u4e49\u65f6\u95f4\u6bb5') ? 'disabled style="background-color: #f3f4f6;"' : ''}
                            >
                        </td>
                        <td class="px-4 py-3 border-b text-sm font-semibold text-center">${record.workHours > 0 ? record.workHours.toFixed(2) : '-'}</td>
                        <td class="px-4 py-3 border-b text-center">
                            <button
                                onclick="clearDayData('${record.date}')"
                                class="inline-flex items-center gap-1 px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white text-xs rounded-lg transition-all shadow-sm hover:shadow-md whitespace-nowrap"
                                title="æ¸…ç©ºè¯¥æ—¥æ•°æ®"
                            >
                                <i data-lucide="trash-2" class="w-3 h-3"></i>
                                æ¸…ç©º
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            // é‡æ–°åˆå§‹åŒ– Lucide å›¾æ ‡
            setTimeout(() => {
                lucide.createIcons();
                
                // æ»šåŠ¨åˆ°å½“å¤©çš„ä½ç½®
                const todayRow = document.getElementById(`row-${today}`);
                if (todayRow) {
                    todayRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }

        // æ›´æ–°è€ƒå‹¤æ•°æ®
        let updateTimeout = null;
        async function updateAttendance(date, field, value, evt) {
            // å¦‚æœæ˜¯è¯·å‡ç±»å‹æ”¹å˜ï¼Œç«‹å³æ›´æ–°UI
            if (field === 'leaveType') {
                const row = evt.target.closest('tr');
                const timeInputs = row.querySelectorAll('input[type="time"]');
                const leaveStartInput = timeInputs[2];
                const leaveEndInput = timeInputs[3];
                
                // æ ¹æ®è¯·å‡ç±»å‹å¯ç”¨/ç¦ç”¨è‡ªå®šä¹‰æ—¶é—´è¾“å…¥æ¡†
                if (value === 'è‡ªå®šä¹‰æ—¶é—´æ®µ') {
                    leaveStartInput.disabled = false;
                    leaveEndInput.disabled = false;
                    leaveStartInput.style.backgroundColor = '';
                    leaveEndInput.style.backgroundColor = '';
                } else {
                    leaveStartInput.disabled = true;
                    leaveEndInput.disabled = true;
                    leaveStartInput.style.backgroundColor = '#f3f4f6';
                    leaveEndInput.style.backgroundColor = '#f3f4f6';
                    // æ¸…ç©ºè‡ªå®šä¹‰æ—¶é—´
                    leaveStartInput.value = '';
                    leaveEndInput.value = '';
                }
            }
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (updateTimeout) {
                clearTimeout(updateTimeout);
            }

            // å»¶è¿Ÿä¿å­˜ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
            updateTimeout = setTimeout(async () => {
                try {
                    // è·å–è¯¥æ—¥æœŸè¡Œçš„æ‰€æœ‰æ•°æ®
                    const row = evt.target.closest('tr');
                    
                    if (!row) {
                        console.error('æ— æ³•æ‰¾åˆ°è¡Œå…ƒç´ ');
                        return;
                    }
                    
                    const timeInputs = row.querySelectorAll('input[type="time"]');
                    const startTimeInput = timeInputs[0];
                    const endTimeInput = timeInputs[1];
                    const leaveStartTimeInput = timeInputs[2];
                    const leaveEndTimeInput = timeInputs[3];
                    
                    // è·å–è¯·å‡ç±»å‹ä¸‹æ‹‰æ¡†
                    const leaveTypeSelect = row.querySelector('select');
                    
                    // è·å–ä¸‹ç­æ—¶é—´æ¬¡æ—¥å¤é€‰æ¡†
                    const endTimeNextDayCheckbox = row.querySelector('input[type="checkbox"]');

                    // ç»„åˆä¸‹ç­æ—¶é—´å’Œæ¬¡æ—¥æ ‡è®°
                    let endTime = endTimeInput?.value || null;
                    if (endTime && endTimeNextDayCheckbox?.checked) {
                        endTime = endTime + '+1';
                    }

                    // è°ƒè¯•æ—¥å¿—
                    console.log('ä¿å­˜æ•°æ®:', {
                        date,
                        field,
                        startTime: startTimeInput?.value,
                        endTime: endTime,
                        endTimeNextDay: endTimeNextDayCheckbox?.checked,
                        leaveType: leaveTypeSelect?.value,
                        leaveStartTime: leaveStartTimeInput?.value,
                        leaveEndTime: leaveEndTimeInput?.value
                    });

                    const requestBody = {
                        date: date,
                        startTime: startTimeInput?.value || null,
                        endTime: endTime,
                        leaveType: leaveTypeSelect?.value || 'æ­£å¸¸',
                        leaveStartTime: leaveStartTimeInput?.value || null,
                        leaveEndTime: leaveEndTimeInput?.value || null,
                        remark: null
                    };

                    const response = await fetch('/api/workhours/attendance/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();

                    if (data.success) {
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        row.classList.add('bg-green-50');
                        setTimeout(() => {
                            row.classList.remove('bg-green-50');
                        }, 1000);
                        console.log('ä¿å­˜æˆåŠŸ');
                        
                        // åªåˆ·æ–°å·¥æ—¶æ˜¾ç¤ºï¼Œä¸é‡æ–°åŠ è½½æ•´ä¸ªè¡¨æ ¼
                        await refreshWorkHours(date, row);
                    } else {
                        alert(`ä¿å­˜å¤±è´¥: ${data.message}`);
                        console.error('ä¿å­˜å¤±è´¥:', data.message);
                    }
                } catch (error) {
                    console.error('ä¿å­˜å¼‚å¸¸:', error);
                    alert(`ä¿å­˜å¤±è´¥: ${error.message}`);
                }
            }, 500); // 500msåä¿å­˜
        }

        // åˆ·æ–°å·¥æ—¶æ˜¾ç¤ºï¼ˆä¸é‡æ–°æ¸²æŸ“æ•´ä¸ªè¡¨æ ¼ï¼‰
        async function refreshWorkHours(date, row) {
            try {
                // é‡æ–°è·å–è¯¥æœˆä»½æ•°æ®
                const response = await fetch(`/api/workhours/excel/data?yearMonth=${currentYearMonth}`);
                const data = await response.json();
                
                if (data.success) {
                    // æ‰¾åˆ°å¯¹åº”æ—¥æœŸçš„è®°å½•
                    const record = data.data.find(r => r.date === date);
                    if (record) {
                        // åªæ›´æ–°å·¥æ—¶åˆ—
                        const workHoursCell = row.querySelector('td:nth-child(8)'); // ç¬¬8åˆ—æ˜¯å·¥æ—¶
                        if (workHoursCell) {
                            workHoursCell.textContent = record.workHours > 0 ? record.workHours.toFixed(2) : '-';
                        }
                        console.log(`å·¥æ—¶å·²æ›´æ–°: ${date} -> ${record.workHours}å°æ—¶`);
                    }
                }
            } catch (error) {
                console.error('åˆ·æ–°å·¥æ—¶å¤±è´¥:', error);
            }
        }

        // æ¸…ç©ºæŸæ—¥æ•°æ®
        async function clearDayData(date) {
            if (!confirm(`ç¡®å®šè¦æ¸…ç©º ${date} çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿ\n\næ­¤æ“ä½œå°†æ¸…ç©ºè¯¥æ—¥çš„ï¼š\nâ€¢ ä¸Šç­æ—¶é—´\nâ€¢ ä¸‹ç­æ—¶é—´\nâ€¢ è¯·å‡ç±»å‹ï¼ˆé‡ç½®ä¸ºæ­£å¸¸ï¼‰\nâ€¢ è¯·å‡è‡ªå®šä¹‰æ—¶é—´`)) {
                return;
            }

            try {
                const requestBody = {
                    date: date,
                    startTime: null,
                    endTime: null,
                    leaveType: 'æ­£å¸¸',
                    leaveStartTime: null,
                    leaveEndTime: null,
                    remark: null
                };

                const response = await fetch('/api/workhours/attendance/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (data.success) {
                    // æ¸…ç©ºæˆåŠŸï¼Œåˆ·æ–°é¡µé¢æ•°æ®
                    alert('âœ… æ•°æ®å·²æ¸…ç©º');
                    loadExcelData(); // é‡æ–°åŠ è½½æ•°æ®
                } else {
                    alert(`âŒ æ¸…ç©ºå¤±è´¥: ${data.message}`);
                }
            } catch (error) {
                console.error('æ¸…ç©ºæ•°æ®å¼‚å¸¸:', error);
                alert(`âŒ æ¸…ç©ºå¤±è´¥: ${error.message}`);
            }
        }

    </script>
</body>
</html>
