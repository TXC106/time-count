<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥æ—¶è®¡ç®—ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <h1 class="text-5xl font-bold text-indigo-900 mb-4">
                ğŸ“Š å·¥æ—¶è®¡ç®—ç³»ç»Ÿ
            </h1>
            <p class="text-gray-600 text-lg">
                æ™ºèƒ½è€ƒå‹¤ç®¡ç† Â· è‡ªåŠ¨å·¥æ—¶ç»Ÿè®¡ Â· æ•°æ®å¯è§†åŒ–åˆ†æ
            </p>
        </header>

        <!-- Main Content -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <!-- åŠŸèƒ½1: ç”Ÿæˆæ¨¡æ¿ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 fade-in">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white text-2xl mr-4">
                        ğŸ“
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">ç”Ÿæˆæ¨¡æ¿</h2>
                </div>
                <p class="text-gray-600 mb-6">
                    è‡ªåŠ¨ç”ŸæˆæŒ‡å®šæœˆä»½çš„è€ƒå‹¤è¡¨æ ¼æ¨¡æ¿ï¼ŒåŒ…å«æ—¥æœŸã€æ˜ŸæœŸç­‰ä¿¡æ¯ã€‚
                </p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            é€‰æ‹©æœˆä»½
                        </label>
                        <input 
                            type="month" 
                            id="templateMonth" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                    </div>
                    
                    <button 
                        onclick="generateTemplate()" 
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95"
                    >
                        <span id="generateBtn">ç”Ÿæˆæ¨¡æ¿</span>
                    </button>
                </div>
                
                <div id="generateResult" class="mt-4"></div>
            </div>

            <!-- åŠŸèƒ½2: å¡«å†™è¯´æ˜ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 fade-in">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white text-2xl mr-4">
                        âœï¸
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">å¡«å†™æ•°æ®</h2>
                </div>
                <p class="text-gray-600 mb-6">
                    åœ¨ç”Ÿæˆçš„Excelæ–‡ä»¶ä¸­å¡«å†™æ¯å¤©çš„ä¸Šä¸‹ç­æ—¶é—´ã€‚
                </p>
                
                <div class="bg-blue-50 rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800 mb-2">ğŸ“‹ æ“ä½œæ­¥éª¤ï¼š</h3>
                    <ol class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">1</span>
                            <span>æ‰“å¼€ <code class="bg-gray-200 px-1 rounded">data</code> ç›®å½•ä¸‹çš„Excelæ–‡ä»¶</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">2</span>
                            <span>åœ¨"ä¸Šç­æ—¶é—´"å’Œ"ä¸‹ç­æ—¶é—´"åˆ—å¡«å†™æ—¶é—´</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">3</span>
                            <span>æ—¶é—´æ ¼å¼ï¼š<code class="bg-gray-200 px-1 rounded font-mono">08:56</code></span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center mr-2 flex-shrink-0 text-xs">4</span>
                            <span>ä¿å­˜æ–‡ä»¶åè¿›è¡Œå·¥æ—¶è®¡ç®—</span>
                        </li>
                    </ol>
                </div>

                <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                    <p class="text-sm text-yellow-800">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>å·²å¡«å†™çš„æ•°æ®ä¸ä¼šè¢«è¦†ç›–
                    </p>
                </div>
            </div>

            <!-- åŠŸèƒ½3: è®¡ç®—å·¥æ—¶ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 fade-in">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white text-2xl mr-4">
                        ğŸ”¢
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">è®¡ç®—å·¥æ—¶</h2>
                </div>
                <p class="text-gray-600 mb-6">
                    è‡ªåŠ¨è®¡ç®—å·¥æ—¶ç»Ÿè®¡ï¼ŒåŒ…æ‹¬æ€»å·¥æ—¶ã€å¹³å‡å·¥æ—¶ã€è¯·å‡ç»Ÿè®¡ç­‰ã€‚
                </p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            é€‰æ‹©æœˆä»½
                        </label>
                        <input 
                            type="month" 
                            id="calculateMonth" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        >
                    </div>
                    
                    <button 
                        onclick="calculateWorkHours()" 
                        class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95"
                    >
                        <span id="calculateBtn">è®¡ç®—å·¥æ—¶</span>
                    </button>
                </div>
                
                <div id="calculateResult" class="mt-4"></div>
            </div>
        </div>

        <!-- ç»Ÿè®¡æŠ¥å‘ŠåŒºåŸŸ -->
        <div id="reportSection" class="hidden">
            <div class="bg-white rounded-2xl shadow-lg p-8 fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">ğŸ“ˆ å·¥æ—¶ç»Ÿè®¡æŠ¥å‘Š</h2>
                    <button 
                        onclick="closeReport()" 
                        class="text-gray-500 hover:text-gray-700 text-2xl"
                    >
                        âœ•
                    </button>
                </div>
                
                <div id="reportContent" class="space-y-6">
                    <!-- æŠ¥å‘Šå†…å®¹å°†åŠ¨æ€æ’å…¥ -->
                </div>
            </div>
        </div>

        <!-- è®¡ç®—è§„åˆ™è¯´æ˜ -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mt-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span class="text-3xl mr-3">â„¹ï¸</span>
                å·¥æ—¶è®¡ç®—è§„åˆ™
            </h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">ğŸ“Œ åŸºæœ¬è§„åˆ™</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>å·¥æ—¶ = ä¸‹ç­æ—¶é—´ - ä¸Šç­æ—¶é—´ - åˆä¼‘ - æ™šé¤</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>æ‰€æœ‰æƒ…å†µæ‰£é™¤ <strong>1å°æ—¶</strong> åˆä¼‘æ—¶é—´</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-2">â€¢</span>
                            <span>ä¸‹ç­æ™šäº19:00æ‰£é™¤ <strong>0.5å°æ—¶</strong> æ™šé¤æ—¶é—´</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold text-lg text-gray-800 mb-3">ğŸ–ï¸ è¯·å‡åˆ¤å®š</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span>ä¸Šä¸‹ç­æ—¶é—´ä¸ºç©ºï¼ˆç¼ºå‹¤ï¼‰</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span>ä¸Šç­æ—¶é—´æ™šäº <strong>09:00</strong>ï¼ˆè¿Ÿåˆ°ï¼‰</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2">â€¢</span>
                            <span>ä¸‹ç­æ—¶é—´æ—©äº <strong>18:00</strong>ï¼ˆæ—©é€€ï¼‰</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-600">
            <p>å·¥æ—¶è®¡ç®—ç³»ç»Ÿ v1.0 | Spring Boot + Apache POI</p>
        </footer>
    </div>

    <script>
        // è®¾ç½®å½“å‰æœˆä»½ä¸ºé»˜è®¤å€¼
        const currentMonth = new Date().toISOString().slice(0, 7);
        document.getElementById('templateMonth').value = currentMonth;
        document.getElementById('calculateMonth').value = currentMonth;

        // ç”Ÿæˆæ¨¡æ¿
        async function generateTemplate() {
            const month = document.getElementById('templateMonth').value;
            const resultDiv = document.getElementById('generateResult');
            const btn = document.getElementById('generateBtn');
            
            if (!month) {
                showMessage(resultDiv, 'è¯·é€‰æ‹©æœˆä»½', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span>';
            
            try {
                const response = await fetch(`/api/workhours/template/generate?yearMonth=${month}`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(resultDiv, `âœ… æ¨¡æ¿ç”ŸæˆæˆåŠŸï¼<br><small class="text-xs">æ–‡ä»¶è·¯å¾„: ${data.filePath}</small>`, 'success');
                } else {
                    showMessage(resultDiv, `âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(resultDiv, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.textContent = 'ç”Ÿæˆæ¨¡æ¿';
            }
        }

        // è®¡ç®—å·¥æ—¶
        async function calculateWorkHours() {
            const month = document.getElementById('calculateMonth').value;
            const resultDiv = document.getElementById('calculateResult');
            const btn = document.getElementById('calculateBtn');
            
            if (!month) {
                showMessage(resultDiv, 'è¯·é€‰æ‹©æœˆä»½', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span>';
            
            try {
                const response = await fetch(`/api/workhours/calculate?yearMonth=${month}`);
                const data = await response.json();
                
                if (data.success) {
                    showMessage(resultDiv, 'âœ… è®¡ç®—å®Œæˆï¼', 'success');
                    displayReport(data.statistics);
                } else {
                    showMessage(resultDiv, `âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(resultDiv, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.textContent = 'è®¡ç®—å·¥æ—¶';
            }
        }

        // æ˜¾ç¤ºæŠ¥å‘Š
        function displayReport(stats) {
            const reportSection = document.getElementById('reportSection');
            const reportContent = document.getElementById('reportContent');
            
            const html = `
                <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl p-6 mb-6">
                    <h3 class="text-2xl font-bold mb-2">${stats.yearMonth}</h3>
                    <p class="text-blue-100">å·¥æ—¶ç»Ÿè®¡æœˆåº¦æŠ¥å‘Š</p>
                </div>

                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600 mb-1">å½“æœˆæ€»å·¥æ—¶</div>
                        <div class="text-3xl font-bold text-blue-600">${stats.totalWorkHours}</div>
                        <div class="text-sm text-gray-500">å°æ—¶</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600 mb-1">å‡ºå‹¤å¤©æ•°</div>
                        <div class="text-3xl font-bold text-green-600">${stats.attendanceDays}</div>
                        <div class="text-sm text-gray-500">å¤©</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600 mb-1">æ—¥å¹³å‡å·¥æ—¶</div>
                        <div class="text-3xl font-bold text-purple-600">${stats.averageWorkHoursPerDay}</div>
                        <div class="text-sm text-gray-500">å°æ—¶/å¤©</div>
                    </div>
                </div>

                <div class="border-t pt-6">
                    <h4 class="font-bold text-lg mb-4">ğŸ¯ æœŸæœ›ç›®æ ‡</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-4">
                            <span class="text-gray-700">æœŸæœ›æ€»å·¥æ—¶</span>
                            <span class="font-bold text-xl">${stats.expectedTotalHours} å°æ—¶</span>
                        </div>
                        <div class="flex justify-between items-center ${stats.remainingHoursToTarget > 0 ? 'bg-orange-50' : 'bg-green-50'} rounded-lg p-4">
                            <span class="text-gray-700">è·ç¦»ç›®æ ‡</span>
                            <span class="font-bold text-xl ${stats.remainingHoursToTarget > 0 ? 'text-orange-600' : 'text-green-600'}">
                                ${stats.remainingHoursToTarget > 0 ? '+' : ''}${stats.remainingHoursToTarget} å°æ—¶
                            </span>
                        </div>
                    </div>
                </div>

                <div class="border-t pt-6 mt-6">
                    <h4 class="font-bold text-lg mb-4">ğŸ“… å‰©ä½™è§„åˆ’</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-4">
                            <span class="text-gray-700">å‰©ä½™å·¥ä½œæ—¥</span>
                            <span class="font-bold text-xl">${stats.remainingWorkdays} å¤©</span>
                        </div>
                        <div class="flex justify-between items-center bg-indigo-50 rounded-lg p-4">
                            <span class="text-gray-700">éœ€è¦æ—¥å‡å·¥æ—¶</span>
                            <span class="font-bold text-xl text-indigo-600">${stats.requiredAverageHoursForRemainingDays} å°æ—¶/å¤©</span>
                        </div>
                    </div>
                </div>

                ${stats.leaveDays > 0 ? `
                <div class="border-t pt-6 mt-6">
                    <h4 class="font-bold text-lg mb-4">ğŸ–ï¸ è¯·å‡ç»Ÿè®¡</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="flex justify-between items-center bg-yellow-50 rounded-lg p-4">
                            <span class="text-gray-700">è¯·å‡å¤©æ•°</span>
                            <span class="font-bold text-xl text-yellow-600">${stats.leaveDays} å¤©</span>
                        </div>
                        <div class="flex justify-between items-center bg-yellow-50 rounded-lg p-4">
                            <span class="text-gray-700">è¯·å‡æ€»æ—¶é•¿</span>
                            <span class="font-bold text-xl text-yellow-600">${stats.totalLeaveHours} å°æ—¶</span>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            reportContent.innerHTML = html;
            reportSection.classList.remove('hidden');
            reportSection.scrollIntoView({ behavior: 'smooth' });
        }

        // å…³é—­æŠ¥å‘Š
        function closeReport() {
            document.getElementById('reportSection').classList.add('hidden');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(element, message, type) {
            const bgColor = type === 'success' ? 'bg-green-50 border-green-500 text-green-800' : 'bg-red-50 border-red-500 text-red-800';
            element.innerHTML = `
                <div class="${bgColor} border-l-4 p-3 rounded text-sm">
                    ${message}
                </div>
            `;
            setTimeout(() => {
                if (type === 'success') {
                    element.innerHTML = '';
                }
            }, 5000);
        }
    </script>
</body>
</html>
