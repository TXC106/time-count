<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®ç®¡ç† - å·¥æ—¶è®¡ç®—ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-amber-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <h1 class="text-5xl font-bold text-orange-900 mb-4">
                âš™ï¸ é…ç½®ç®¡ç†
            </h1>
            <p class="text-gray-600 text-lg mb-6">
                è‡ªå®šä¹‰å·¥æ—¶è®¡ç®—è§„åˆ™å’ŒæœŸæœ›æ€»å·¥æ—¶
            </p>
            <div class="flex justify-center gap-4">
                <a href="/" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                    ğŸ“Š ç»Ÿè®¡é¢æ¿
                </a>
                <a href="/attendance.html" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                    âœ“ æ‰“å¡è€ƒå‹¤
                </a>
                <a href="/config.html" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-semibold">
                    âš™ï¸ é…ç½®ç®¡ç†
                </a>
                <a href="/calendar.html" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold">
                    ğŸ“… æ—¥å†è§†å›¾
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <div class="bg-white rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-300 fade-in max-w-2xl mx-auto">
            <div class="flex items-center mb-6">
                <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center text-white text-3xl mr-4">
                    âš™ï¸
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">é…ç½®ç®¡ç†</h2>
                    <p class="text-gray-600 mt-1">è‡ªå®šä¹‰æ‚¨çš„å·¥æ—¶è®¡ç®—è§„åˆ™</p>
                </div>
            </div>
            
            <div class="space-y-5">
                <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-5 border border-orange-200">
                    <h3 class="font-semibold text-lg text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ¯</span>
                        å·¥æ—¶ç›®æ ‡è®¾ç½®
                    </h3>
                    <div class="flex justify-between items-center">
                        <label class="text-gray-700 font-medium">æœŸæœ›æ€»å·¥æ—¶</label>
                        <div class="flex items-center">
                            <input 
                                type="number" 
                                id="configExpectedHours" 
                                step="0.5"
                                class="w-28 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                            >
                            <span class="ml-3 text-gray-600 font-medium">å°æ—¶</span>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg p-5 border border-blue-200">
                    <h3 class="font-semibold text-lg text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">â°</span>
                        ä¼‘æ¯æ—¶é—´è®¾ç½®
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-gray-700 font-medium">åˆä¼‘æ—¶é—´</label>
                            <div class="flex items-center">
                                <input 
                                    type="number" 
                                    id="configLunchBreak" 
                                    step="0.5"
                                    class="w-28 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                                >
                                <span class="ml-3 text-gray-600 font-medium">å°æ—¶</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <label class="text-gray-700 font-medium">æ™šé¤æ—¶é—´</label>
                            <div class="flex items-center">
                                <input 
                                    type="number" 
                                    id="configDinnerBreak" 
                                    step="0.5"
                                    class="w-28 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                                >
                                <span class="ml-3 text-gray-600 font-medium">å°æ—¶</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <label class="text-gray-700 font-medium">æ™šé¤ä¸´ç•Œç‚¹</label>
                            <div class="flex items-center">
                                <input 
                                    type="number" 
                                    id="configDinnerThreshold" 
                                    min="0"
                                    max="23"
                                    class="w-28 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                                >
                                <span class="ml-3 text-gray-600 font-medium">ç‚¹</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-5 border border-purple-200">
                    <h3 class="font-semibold text-lg text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ•</span>
                        æ ‡å‡†å·¥ä½œæ—¶é—´
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-gray-700 font-medium">æ ‡å‡†ä¸Šç­æ—¶é—´</label>
                            <div class="flex items-center">
                                <input 
                                    type="number" 
                                    id="configStandardStart" 
                                    min="0"
                                    max="23"
                                    class="w-28 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                                >
                                <span class="ml-3 text-gray-600 font-medium">ç‚¹</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <label class="text-gray-700 font-medium">æ ‡å‡†ä¸‹ç­æ—¶é—´</label>
                            <div class="flex items-center">
                                <input 
                                    type="number" 
                                    id="configStandardEnd" 
                                    min="0"
                                    max="23"
                                    class="w-28 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                                >
                                <span class="ml-3 text-gray-600 font-medium">ç‚¹</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-lg p-5 border border-green-200">
                    <h3 class="font-semibold text-lg text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">ğŸ“</span>
                        æ–‡ä»¶å­˜å‚¨è®¾ç½®
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-gray-700 font-medium block mb-2">æ•°æ®æ–‡ä»¶å­˜å‚¨ç›®å½•</label>
                            <div class="flex gap-2">
                                <input 
                                    type="text" 
                                    id="configDataDirectory" 
                                    placeholder="ä¾‹å¦‚ï¼šdata æˆ– D:/attendance"
                                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                                >
                                <button 
                                    onclick="selectDirectory()" 
                                    class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all whitespace-nowrap"
                                    title="é€‰æ‹©æ–‡ä»¶å¤¹"
                                >
                                    ğŸ“‚ æµè§ˆ
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ dataï¼‰æˆ–ç»å¯¹è·¯å¾„ï¼ˆå¦‚ D:/attendanceï¼‰</p>
                        </div>
                        
                        <div>
                            <label class="text-gray-700 font-medium block mb-2">æ–‡ä»¶åæ ¼å¼</label>
                            <input 
                                type="text" 
                                id="configFileNameFormat" 
                                placeholder="ä¾‹å¦‚ï¼šattendance_{yearMonth}.xlsx"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-lg"
                            >
                            <p class="text-xs text-gray-500 mt-1">ä½¿ç”¨ {yearMonth} ä½œä¸ºå ä½ç¬¦ï¼Œæ ¼å¼ä¸º YYYY-MM</p>
                            
                            <div class="mt-3">
                                <p class="text-xs text-gray-600 font-semibold mb-2">ğŸ“‹ å‚è€ƒæ ¼å¼ï¼š</p>
                                <div class="grid grid-cols-2 gap-2">
                                    <button 
                                        onclick="setFileNameFormat('attendance_{yearMonth}.xlsx')" 
                                        class="text-left px-3 py-2 bg-white border border-gray-300 rounded hover:bg-green-50 hover:border-green-400 transition-all text-sm"
                                    >
                                        <span class="text-green-600">âœ“</span> attendance_{yearMonth}.xlsx
                                    </button>
                                    <button 
                                        onclick="setFileNameFormat('è€ƒå‹¤_{yearMonth}.xlsx')" 
                                        class="text-left px-3 py-2 bg-white border border-gray-300 rounded hover:bg-green-50 hover:border-green-400 transition-all text-sm"
                                    >
                                        <span class="text-green-600">âœ“</span> è€ƒå‹¤_{yearMonth}.xlsx
                                    </button>
                                    <button 
                                        onclick="setFileNameFormat('workhours_{yearMonth}.xlsx')" 
                                        class="text-left px-3 py-2 bg-white border border-gray-300 rounded hover:bg-green-50 hover:border-green-400 transition-all text-sm"
                                    >
                                        <span class="text-green-600">âœ“</span> workhours_{yearMonth}.xlsx
                                    </button>
                                    <button 
                                        onclick="setFileNameFormat('{yearMonth}_attendance.xlsx')" 
                                        class="text-left px-3 py-2 bg-white border border-gray-300 rounded hover:bg-green-50 hover:border-green-400 transition-all text-sm"
                                    >
                                        <span class="text-green-600">âœ“</span> {yearMonth}_attendance.xlsx
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 pt-4">
                    <button 
                        onclick="loadConfig()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 text-lg shadow-lg"
                    >
                        ğŸ”„ åŠ è½½å½“å‰é…ç½®
                    </button>
                    <button 
                        onclick="saveConfig()" 
                        class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95 text-lg shadow-lg"
                    >
                        <span id="configBtn">ğŸ’¾ ä¿å­˜é…ç½®</span>
                    </button>
                </div>
            </div>
            
            <div id="configResult" class="mt-6"></div>

            <div class="mt-6 space-y-3">
                <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <p class="text-blue-800 text-sm">
                        <strong>ğŸ’¡ æç¤ºï¼š</strong>é…ç½®ä¿®æ”¹åä¼šç«‹å³ç”Ÿæ•ˆï¼Œå½±å“åç»­çš„å·¥æ—¶è®¡ç®—
                    </p>
                </div>
                <div class="p-4 bg-orange-50 border-l-4 border-orange-400 rounded">
                    <p class="text-orange-800 text-sm">
                        <strong>âš ï¸ æ³¨æ„ï¼š</strong>æ™šé¤ä¸´ç•Œç‚¹è¡¨ç¤ºä¸‹ç­æ—¶é—´è¶…è¿‡è¯¥æ—¶é—´ç‚¹åï¼Œä¼šæ‰£é™¤æ™šé¤æ—¶é—´
                    </p>
                </div>
            </div>
        </div>

        <!-- é…ç½®è¯´æ˜ -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mt-8 fade-in max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span class="text-3xl mr-3">ğŸ“–</span>
                é…ç½®è¯´æ˜
            </h2>
            
            <div class="space-y-4">
                <div class="border-l-4 border-orange-500 pl-4">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">æœŸæœ›æ€»å·¥æ—¶</h3>
                    <p class="text-gray-600 text-sm">
                        è®¾ç½®æ¯æœˆæœŸæœ›è¾¾åˆ°çš„æ€»å·¥æ—¶æ•°ï¼Œç³»ç»Ÿä¼šæ ¹æ®æ­¤å€¼è®¡ç®—ä¸ç›®æ ‡çš„å·®è·ï¼Œä»¥åŠå‰©ä½™å·¥ä½œæ—¥éœ€è¦çš„å¹³å‡å·¥æ—¶ã€‚
                    </p>
                </div>
                
                <div class="border-l-4 border-blue-500 pl-4">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">åˆä¼‘æ—¶é—´</h3>
                    <p class="text-gray-600 text-sm">
                        æ¯å¤©å·¥ä½œæ—¶é—´ä¸­æ‰£é™¤çš„åˆä¼‘æ—¶é•¿ã€‚æ­£å¸¸å‡ºå‹¤æ—¶ä¼šè‡ªåŠ¨æ‰£é™¤æ­¤æ—¶é—´ã€‚
                    </p>
                </div>
                
                <div class="border-l-4 border-purple-500 pl-4">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">æ™šé¤æ—¶é—´ä¸ä¸´ç•Œç‚¹</h3>
                    <p class="text-gray-600 text-sm">
                        å½“ä¸‹ç­æ—¶é—´æ™šäºæ™šé¤ä¸´ç•Œç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰£é™¤æ™šé¤æ—¶é—´ã€‚ä¾‹å¦‚ï¼šä¸´ç•Œç‚¹è®¾ä¸º19ç‚¹ï¼Œæ™šé¤æ—¶é—´0.5å°æ—¶ï¼Œåˆ™19ç‚¹åä¸‹ç­ä¼šæ‰£é™¤0.5å°æ—¶ã€‚
                    </p>
                </div>
                
                <div class="border-l-4 border-green-500 pl-4">
                    <h3 class="font-semibold text-lg text-gray-800 mb-2">æ ‡å‡†å·¥ä½œæ—¶é—´</h3>
                    <p class="text-gray-600 text-sm">
                        ç”¨äºåˆ¤å®šè¿Ÿåˆ°ã€æ—©é€€å’Œè¯·å‡ã€‚ä¸Šç­æ™šäºæ ‡å‡†ä¸Šç­æ—¶é—´æˆ–ä¸‹ç­æ—©äºæ ‡å‡†ä¸‹ç­æ—¶é—´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºè¯·å‡ã€‚
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-600">
            <p>å·¥æ—¶è®¡ç®—ç³»ç»Ÿ v1.0 | Spring Boot + Apache POI</p>
        </footer>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é…ç½®
        window.addEventListener('load', function() {
            loadConfig();
        });

        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const response = await fetch('/api/workhours/config');
                const data = await response.json();
                
                if (data.success) {
                    const config = data.config;
                    document.getElementById('configExpectedHours').value = config.expectedTotalHours;
                    document.getElementById('configLunchBreak').value = config.lunchBreakHours;
                    document.getElementById('configDinnerBreak').value = config.dinnerBreakHours;
                    document.getElementById('configDinnerThreshold').value = config.dinnerBreakThresholdHour;
                    document.getElementById('configStandardStart').value = config.standardStartHour;
                    document.getElementById('configStandardEnd').value = config.standardEndHour;
                    document.getElementById('configDataDirectory').value = config.dataDirectory || 'data';
                    document.getElementById('configFileNameFormat').value = config.fileNameFormat || 'attendance_{yearMonth}.xlsx';
                    
                    showMessage(document.getElementById('configResult'), 'âœ… é…ç½®åŠ è½½æˆåŠŸ', 'success');
                } else {
                    showMessage(document.getElementById('configResult'), `âŒ åŠ è½½å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                showMessage(document.getElementById('configResult'), `âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ä¿å­˜é…ç½®
        async function saveConfig() {
            const resultDiv = document.getElementById('configResult');
            const btn = document.getElementById('configBtn');
            
            const configData = {
                expectedTotalHours: parseFloat(document.getElementById('configExpectedHours').value),
                lunchBreakHours: parseFloat(document.getElementById('configLunchBreak').value),
                dinnerBreakHours: parseFloat(document.getElementById('configDinnerBreak').value),
                dinnerBreakThresholdHour: parseInt(document.getElementById('configDinnerThreshold').value),
                standardStartHour: parseInt(document.getElementById('configStandardStart').value),
                standardEndHour: parseInt(document.getElementById('configStandardEnd').value),
                dataDirectory: document.getElementById('configDataDirectory').value,
                fileNameFormat: document.getElementById('configFileNameFormat').value
            };

            // éªŒè¯æ•°æ®
            if (isNaN(configData.expectedTotalHours) || isNaN(configData.lunchBreakHours) || 
                isNaN(configData.dinnerBreakHours) || isNaN(configData.dinnerBreakThresholdHour) ||
                isNaN(configData.standardStartHour) || isNaN(configData.standardEndHour)) {
                showMessage(resultDiv, 'âŒ è¯·å¡«å†™æ‰€æœ‰é…ç½®é¡¹', 'error');
                return;
            }

            btn.innerHTML = '<span class="loading"></span>';
            
            try {
                const response = await fetch('/api/workhours/config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(configData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(resultDiv, 'âœ… é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    showMessage(resultDiv, `âŒ ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(resultDiv, `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                btn.innerHTML = 'ğŸ’¾ ä¿å­˜é…ç½®';
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(element, message, type) {
            const bgColor = type === 'success' ? 'bg-green-50 border-green-500 text-green-800' : 'bg-red-50 border-red-500 text-red-800';
            element.innerHTML = `
                <div class="${bgColor} border-l-4 p-4 rounded text-sm animate-pulse">
                    ${message}
                </div>
            `;
            setTimeout(() => {
                if (type === 'success') {
                    element.innerHTML = '';
                }
            }, 5000);
        }

        // é€‰æ‹©æ–‡ä»¶å¤¹
        function selectDirectory() {
            // åˆ›å»ºä¸€ä¸ªéšè—çš„inputå…ƒç´ ç”¨äºé€‰æ‹©æ–‡ä»¶å¤¹
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true; // Chrome/Edge
            input.directory = true; // Firefox
            input.multiple = true;
            
            input.onchange = function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    // è·å–ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶æå–ç›®å½•è·¯å¾„
                    const fullPath = files[0].webkitRelativePath || files[0].name;
                    const dirPath = fullPath.split('/')[0];
                    
                    // å°è¯•è·å–å®Œæ•´è·¯å¾„ï¼ˆæµè§ˆå™¨å®‰å…¨é™åˆ¶å¯èƒ½æ— æ³•è·å–ï¼‰
                    if (files[0].path) {
                        // Electronç¯å¢ƒä¸‹å¯ä»¥è·å–å®Œæ•´è·¯å¾„
                        const fullDirPath = files[0].path.substring(0, files[0].path.lastIndexOf('\\'));
                        document.getElementById('configDataDirectory').value = fullDirPath;
                    } else {
                        // æµè§ˆå™¨ç¯å¢ƒä¸‹åªèƒ½è·å–ç›¸å¯¹è·¯å¾„
                        document.getElementById('configDataDirectory').value = dirPath;
                        alert('æµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼šåªèƒ½è·å–æ–‡ä»¶å¤¹åç§°ã€‚\nè¯·æ‰‹åŠ¨è¾“å…¥å®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚ï¼šD:/attendance');
                    }
                }
            };
            
            input.click();
        }

        // è®¾ç½®æ–‡ä»¶åæ ¼å¼
        function setFileNameFormat(format) {
            document.getElementById('configFileNameFormat').value = format;
            // æ·»åŠ è§†è§‰åé¦ˆ
            const input = document.getElementById('configFileNameFormat');
            input.classList.add('ring-2', 'ring-green-500');
            setTimeout(() => {
                input.classList.remove('ring-2', 'ring-green-500');
            }, 500);
        }
    </script>
</body>
</html>
